# MyShell - è·¨å¹³å°Shellå·¥å…·

![C++](https://img.shields.io/badge/C%2B%2B-17-blue.svg)
![Platform](https://img.shields.io/badge/platform-Linux%20%7C%20macOS%20%7C%20Windows-green.svg)
![License](https://img.shields.io/badge/license-MIT-brightgreen.svg)
![Build](https://img.shields.io/badge/build-CMake-orange.svg)

<div align="center">
  <img src="https://github.com/user-attachments/assets/shell-demo.gif" alt="MyShell Demo" width="600">
</div>

## é¡¹ç›®ç®€ä»‹

MyShellæ˜¯ä¸€ä¸ªç”¨C++å¼€å‘çš„è·¨å¹³å°shellå·¥å…·ï¼Œæ”¯æŒLinuxã€Windowså’ŒmacOSï¼Œæä¾›äº†å®Œæ•´çš„å‘½ä»¤è¡Œäº¤äº’ç¯å¢ƒï¼Œæ”¯æŒå†…ç½®å‘½ä»¤ã€å¤–éƒ¨ç¨‹åºæ‰§è¡Œã€è¾“å…¥è¾“å‡ºé‡å®šå‘ã€ç®¡é“æ“ä½œç­‰åŠŸèƒ½ã€‚

## å¹³å°æ”¯æŒ

| å¹³å° | çŠ¶æ€ | æ„å»ºå·¥å…· |
|------|------|----------|
| Linux | âœ… å®Œå…¨æ”¯æŒ | CMake, Make, XMake |
| macOS | âœ… å®Œå…¨æ”¯æŒ | CMake, Make |
| Windows | âœ… å®Œå…¨æ”¯æŒ | CMake, Visual Studio, MinGW |

### å¹³å°ç‰¹æ€§å¯¹æ¯”

| åŠŸèƒ½ | Linux | macOS | Windows |
|------|-------|-------|----------|
| è¿›ç¨‹ç®¡ç† | fork/exec | fork/exec | CreateProcess |
| ç®¡é“æ”¯æŒ | pipe() | pipe() | CreatePipe |
| é‡å®šå‘ | dup2() | dup2() | SetStdHandle |
| ä¿¡å·å¤„ç† | signal() | signal() | SetConsoleCtrlHandler |
| è·¯å¾„åˆ†éš”ç¬¦ | / | / | \\ |
| å¯æ‰§è¡Œæ–‡ä»¶ | ä»»æ„ | ä»»æ„ | .exe, .bat, .cmd |

## åŠŸèƒ½ç‰¹æ€§

### åŸºç¡€åŠŸèƒ½
- âœ… å‘½ä»¤è¡Œè§£æå’Œè¯æ³•åˆ†æ
- âœ… å†…ç½®å‘½ä»¤å®ç°ï¼ˆcdã€pwdã€exitã€helpã€echoç­‰ï¼‰
- âœ… å¤–éƒ¨ç¨‹åºæ‰§è¡Œ
- âœ… è¾“å…¥/è¾“å‡ºé‡å®šå‘ï¼ˆ`>`, `>>`, `<`ï¼‰
- âœ… ç®¡é“æ”¯æŒï¼ˆ`|`ï¼‰
- âœ… ç¯å¢ƒå˜é‡ç®¡ç†
- âœ… å‘½ä»¤å†å²è®°å½•
- âœ… åå°è¿›ç¨‹æ‰§è¡Œï¼ˆ`&`ï¼‰

### ğŸ†• å¢å¼ºåŠŸèƒ½
- âœ¨ **æ™ºèƒ½è‡ªåŠ¨è¡¥å…¨**: å‘½ä»¤ã€æ–‡ä»¶è·¯å¾„ã€ç¯å¢ƒå˜é‡è¡¥å…¨
- âœ¨ **è¯­æ³•é«˜äº®**: å®æ—¶è¯­æ³•é«˜äº®æ˜¾ç¤ºï¼Œæå‡ä½¿ç”¨ä½“éªŒ
- âœ¨ **é…ç½®ç®¡ç†**: é€šè¿‡setå‘½ä»¤æ§åˆ¶åŠŸèƒ½å¼€å…³
- âœ¨ **Readlineé›†æˆ**: è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨GNU Readlineåº“

### å†…ç½®å‘½ä»¤

| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | `help` |
| `exit [n]` | é€€å‡ºshellï¼Œå¯é€‰æ‹©é€€å‡ºç  | `exit 0` |
| `pwd` | æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½• | `pwd` |
| `cd [dir]` | åˆ‡æ¢ç›®å½•ï¼Œæ— å‚æ•°æ—¶åˆ‡æ¢åˆ°HOME | `cd /tmp` |
| `echo [-n] text` | æ˜¾ç¤ºæ–‡æœ¬ï¼Œ-né€‰é¡¹ä¸æ¢è¡Œ | `echo "Hello World"` |
| `export var=value` | è®¾ç½®ç¯å¢ƒå˜é‡ | `export PATH=/usr/bin` |
| `env` | æ˜¾ç¤ºæ‰€æœ‰ç¯å¢ƒå˜é‡ | `env` |
| `unset var` | åˆ é™¤ç¯å¢ƒå˜é‡ | `unset PATH` |
| `history` | æ˜¾ç¤ºå‘½ä»¤å†å² | `history` |
| `clear` | æ¸…å± | `clear` |
| `which cmd` | æŸ¥æ‰¾å‘½ä»¤ä½ç½® | `which ls` |
| `set [option] [value]` | é…ç½®è‡ªåŠ¨è¡¥å…¨å’Œè¯­æ³•é«˜äº® | `set completion on` |

### ç‰¹æ®ŠåŠŸèƒ½

- **è¾“å‡ºé‡å®šå‘**: `command > file` æˆ– `command >> file`
- **è¾“å…¥é‡å®šå‘**: `command < file`
- **ç®¡é“**: `command1 | command2`
- **åå°è¿è¡Œ**: `command &`
- **ç¯å¢ƒå˜é‡æ›¿æ¢**: `echo $HOME`
- **æ”¯æŒå¼•å·**: `echo "hello world"`
- **Tabè¡¥å…¨**: è‡ªåŠ¨è¡¥å…¨å‘½ä»¤å’Œæ–‡ä»¶è·¯å¾„ï¼ˆéœ€è¦readlineï¼‰
- **è¯­æ³•é«˜äº®**: å®æ—¶é«˜äº®å‘½ä»¤å’Œå‚æ•°

## æ¶æ„è®¾è®¡

```
mysh/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.cpp           # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ shell.h/.cpp       # Shellä¸»ç±»
â”‚   â”œâ”€â”€ parser.h/.cpp      # å‘½ä»¤è§£æå™¨
â”‚   â”œâ”€â”€ executor.h/.cpp    # å‘½ä»¤æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ builtin.h/.cpp     # å†…ç½®å‘½ä»¤
â”‚   â””â”€â”€ history.h/.cpp     # å‘½ä»¤å†å²
â””â”€â”€ xmake.lua             # æ„å»ºé…ç½®
```

### æ ¸å¿ƒç»„ä»¶

1. **Shellç±»**: ä¸»æ§åˆ¶å™¨ï¼Œè´Ÿè´£ç”¨æˆ·äº¤äº’å’Œç»„ä»¶åè°ƒ
2. **Parserç±»**: è¯æ³•åˆ†æå’Œè¯­æ³•è§£æï¼Œæ”¯æŒå¤æ‚å‘½ä»¤è§£æ
3. **Executorç±»**: æ‰§è¡Œå¤–éƒ¨ç¨‹åºï¼Œå¤„ç†è¿›ç¨‹ç®¡ç†å’Œä¿¡å·
4. **BuiltinCommandsç±»**: å®ç°æ‰€æœ‰å†…ç½®å‘½ä»¤
5. **Historyç±»**: å‘½ä»¤å†å²è®°å½•å’ŒæŒä¹…åŒ–

## ç¼–è¯‘è¿è¡Œ

### å‰ç½®æ¡ä»¶

**æ‰€æœ‰å¹³å°**:
- CMake 3.15+
- C++17å…¼å®¹çš„ç¼–è¯‘å™¨

**Linux/macOS**:
- GCC 7+ æˆ– Clang 5+
- Make (å¯é€‰)

**Windows**:
- Visual Studio 2017+ æˆ– MinGW-w64
- Windows 10+ (æ¨è)

### å¿«é€Ÿå¼€å§‹

#### ä½¿ç”¨è·¨å¹³å°æ„å»ºè„šæœ¬ (æ¨è)

**Linux/macOS**:
```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x build.sh

# æ„å»ºé¡¹ç›®
./build.sh build

# è¿è¡Œ
./build-linux/bin/mysh  # Linux
./build-macos/bin/mysh  # macOS
```

**Windows**:
```cmd
REM æ„å»ºé¡¹ç›®
build.bat build

REM è¿è¡Œ
build-windows\bin\mysh.exe
```

#### ä½¿ç”¨CMake (æ‰€æœ‰å¹³å°)

```bash
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# é…ç½®
cmake ..

# ç¼–è¯‘
cmake --build .

# è¿è¡Œ
./bin/mysh          # Linux/macOS
.\bin\mysh.exe      # Windows
```

#### ä¼ ç»Ÿæ–¹å¼ (Linux/macOS)

```bash
# ä½¿ç”¨Make
make
./mysh

# ä½¿ç”¨XMake
xmake
./build/linux/x86_64/release/mysh
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬æ“ä½œ
```bash
# æŸ¥çœ‹å½“å‰ç›®å½•
snow@mysh:~$ pwd
/home/snow

# åˆ‡æ¢ç›®å½•
snow@mysh:~$ cd /tmp
snow@mysh:/tmp$ 

# åˆ—å‡ºæ–‡ä»¶
snow@mysh:/tmp$ ls -la

# ä½¿ç”¨ç¯å¢ƒå˜é‡
snow@mysh:/tmp$ echo $HOME
/home/snow
```

### é‡å®šå‘å’Œç®¡é“
```bash
# è¾“å‡ºé‡å®šå‘
snow@mysh:~$ echo "Hello World" > hello.txt

# è¿½åŠ è¾“å‡º
snow@mysh:~$ echo "Second line" >> hello.txt

# è¾“å…¥é‡å®šå‘
snow@mysh:~$ wc -l < hello.txt

# ç®¡é“æ“ä½œ
snow@mysh:~$ ls -la | grep ".txt"
snow@mysh:~$ ps aux | grep mysh | wc -l
```

### åå°è¿›ç¨‹
```bash
# åå°è¿è¡Œç¨‹åº
snow@mysh:~$ sleep 60 &
[Background] Process 12345 started

# ç»§ç»­ä½¿ç”¨shell
snow@mysh:~$ pwd
```

### å‘½ä»¤å†å²
```bash
# æŸ¥çœ‹å†å²è®°å½•
snow@mysh:~$ history

# æŸ¥çœ‹æœ€å10æ¡
snow@mysh:~$ history -10

# æœç´¢å†å²
snow@mysh:~$ history grep

# æ¸…ç©ºå†å²
snow@mysh:~$ history -c
```

## æŠ€æœ¯å®ç°è¦ç‚¹

### 1. å‘½ä»¤è§£æ
- æ”¯æŒå¼•å·å¤„ç†
- ç¯å¢ƒå˜é‡å±•å¼€
- ç‰¹æ®Šå­—ç¬¦è¯†åˆ«
- ç®¡é“ç¬¦è§£æ

### 2. è¿›ç¨‹ç®¡ç†
- fork/execæ¨¡å‹
- ä¿¡å·å¤„ç†
- ä½œä¸šæ§åˆ¶
- åƒµå°¸è¿›ç¨‹æ¸…ç†

### 3. é‡å®šå‘å®ç°
- æ–‡ä»¶æè¿°ç¬¦æ“ä½œ
- dup2ç³»ç»Ÿè°ƒç”¨
- æ ‡å‡†è¾“å…¥è¾“å‡ºç®¡ç†

### 4. ç®¡é“å®ç°
- pipeç³»ç»Ÿè°ƒç”¨
- å¤šè¿›ç¨‹åè°ƒ
- æ–‡ä»¶æè¿°ç¬¦ä¼ é€’

## æ‰©å±•åŠŸèƒ½å»ºè®®

1. **Tabè¡¥å…¨**: æ–‡ä»¶åå’Œå‘½ä»¤è‡ªåŠ¨è¡¥å…¨
2. **ä½œä¸šæ§åˆ¶**: å‰å°/åå°ä½œä¸šç®¡ç†ï¼ˆjobs, fg, bgï¼‰
3. **é€šé…ç¬¦**: æ–‡ä»¶åé€šé…ç¬¦å±•å¼€ï¼ˆ*, ?ï¼‰
4. **åˆ«åç³»ç»Ÿ**: å‘½ä»¤åˆ«åå®šä¹‰å’Œä½¿ç”¨
5. **é…ç½®æ–‡ä»¶**: å¯åŠ¨é…ç½®æ–‡ä»¶æ”¯æŒ
6. **é¢œè‰²è¾“å‡º**: å½©è‰²æç¤ºç¬¦å’Œè¯­æ³•é«˜äº®
7. **è„šæœ¬æ‰§è¡Œ**: Shellè„šæœ¬æ–‡ä»¶æ‰§è¡Œ

## å¼€å‘æ”¶è·

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œä½ å°†å­¦ä¹ åˆ°ï¼š

- Linuxç³»ç»Ÿç¼–ç¨‹åŸºç¡€
- è¿›ç¨‹ç®¡ç†å’Œä¿¡å·å¤„ç†
- æ–‡ä»¶æè¿°ç¬¦å’ŒI/Oé‡å®šå‘
- ç®¡é“é€šä¿¡æœºåˆ¶
- C++é¢å‘å¯¹è±¡è®¾è®¡
- è¯æ³•åˆ†æå’Œè¯­æ³•è§£æ
- ç”¨æˆ·ç•Œé¢è®¾è®¡
- è½¯ä»¶æ¶æ„è®¾è®¡

è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç³»ç»Ÿç¼–ç¨‹ç»ƒä¹ é¡¹ç›®ï¼Œæ¶µç›–äº†æ“ä½œç³»ç»Ÿçš„å¤šä¸ªé‡è¦æ¦‚å¿µï¼